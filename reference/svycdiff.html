<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Controlled Difference Estimation for Complex Surveys — svycdiff • svycdiff</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Controlled Difference Estimation for Complex Surveys — svycdiff"><meta property="og:description" content="This is the main function to estimate population average controlled
difference (ACD), or under stronger assumptions, the population average
treatment effect (PATE), for a given outcome between levels of a binary
treatment, exposure, or other group membership variable of interest for
clustered, stratified survey samples where sample selection depends on
the comparison group."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">svycdiff</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/svycdiff.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/salernos/svycdiff/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Controlled Difference Estimation for Complex Surveys</h1>
    <small class="dont-index">Source: <a href="https://github.com/salernos/svycdiff/blob/master/R/main.R" class="external-link"><code>R/main.R</code></a></small>
    <div class="hidden name"><code>svycdiff.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This is the main function to estimate population average controlled
difference (ACD), or under stronger assumptions, the population average
treatment effect (PATE), for a given outcome between levels of a binary
treatment, exposure, or other group membership variable of interest for
clustered, stratified survey samples where sample selection depends on
the comparison group.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">svycdiff</span><span class="op">(</span></span>
<span>  <span class="va">df</span>,</span>
<span>  <span class="va">id_form</span>,</span>
<span>  <span class="va">a_form</span>,</span>
<span>  <span class="va">s_form</span>,</span>
<span>  <span class="va">y_form</span>,</span>
<span>  y_fam <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  strata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cluster <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-df">df<a class="anchor" aria-label="anchor" href="#arg-df"></a></dt>
<dd><p>a data frame or tibble containing the variables in the models.</p></dd>


<dt id="arg-id-form">id_form<a class="anchor" aria-label="anchor" href="#arg-id-form"></a></dt>
<dd><p>a string indicating which identification formula to be used.
Options include "OM", "IPW1", or "IPW2". See 'Details' for more information.</p></dd>


<dt id="arg-a-form">a_form<a class="anchor" aria-label="anchor" href="#arg-a-form"></a></dt>
<dd><p>an object of class `formula` which describes the propensity
score model to be fit.</p></dd>


<dt id="arg-s-form">s_form<a class="anchor" aria-label="anchor" href="#arg-s-form"></a></dt>
<dd><p>an object of class `formula` which describes the selection
model to be fit.</p></dd>


<dt id="arg-y-form">y_form<a class="anchor" aria-label="anchor" href="#arg-y-form"></a></dt>
<dd><p>an object of class `formula` which describes the outcome model
to be fit. Only used if `id_form` = "OM", else `y_form = y ~ 1`.</p></dd>


<dt id="arg-y-fam">y_fam<a class="anchor" aria-label="anchor" href="#arg-y-fam"></a></dt>
<dd><p>a family function. Only used if `id_form` = "OM", else
`y_fam = NULL`.</p></dd>


<dt id="arg-strata">strata<a class="anchor" aria-label="anchor" href="#arg-strata"></a></dt>
<dd><p>a string indicating strata, else `strata = NULL` for no strata.</p></dd>


<dt id="arg-cluster">cluster<a class="anchor" aria-label="anchor" href="#arg-cluster"></a></dt>
<dd><p>a string indicating cluster IDs, else `cluster = NULL` for no
clusters.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>`svycdiff` returns an object of class "svycdiff" which contains:</p>
<dl><dt>id_form</dt>
<dd><p>A string denoting Which method was selected for estimation</p></dd>

   <dt>cdiff</dt>
<dd><p>A named vector containing the point estimate (est),
                standard error (err), lower confidence limit (lcl),
                upper confidence limit (ucl), and p-value (pval) for
                the estimated controlled difference</p></dd>

   <dt>fit_y</dt>
<dd><p>An object of class inheriting from "glm" corresponding to
                the outcome model fit, or NULL for IPW1 and IPW2</p></dd>

   <dt>fit_a</dt>
<dd><p>An object of class inheriting from "glm" corresponding to
                the propensity model fit</p></dd>

   <dt>wtd_fit_a</dt>
<dd><p>An object of class inheriting from "glm" corresponding
                    to the weighted propensity model fit</p></dd>

   <dt>fit_s</dt>
<dd><p>An object of class "betareg" corresponding to the selection
                model fit, or NULL if the selection mechanism is known</p></dd>


</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The argument <code>id_form</code> takes possible values "OM", "IPW1", or "IPW2",
corresponding to the three formulas presented in Salerno et al. "OM" refers
to the method that uses outcome modeling and direct standardization to
estimate the controlled difference, while IPW1 and IPW2 are inverse
probability weighted methods. IPW1 and IPW2 differ with respect to how the
joint propensity and selection mechanisms are factored (see Salerno et al.
for additional details). "OM", "IPW1", or "IPW2" are useful in different
settings, which warrants some brief discussion here. "OM" requires you to
specify an outcome regression model, whereas "IPW1" and "IPW2" do not
require estimation, nor do they assume additivity or interactivity. However,
while OM, IPW1, and IPW2 are consistent, OM is most efficient if correctly
specified.</p>
<p>For IPW1/IPW2, <code>y_form</code> should be of the form <code>Y ~ 1</code>.</p>
<p>For known S, <code>s_form</code> should be of the form <code>S ~ 1</code>, where
<code>S</code> is the variable corresponding to the probability of selection.
There should be two additional variables in the dataset: P_S_cond_A1X and
P_S_cond_A0X, corresponding to the known probability of selection
conditional on A = 1 or 0 and X = x, respectively. If these quantities are
not known, s_form should contain the variables which affect sample selection
on the right hand side of the equation, including the comparison group
variable of interest.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="simdat.html">simdat</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="va">dat</span><span class="op">$</span><span class="va">P_S_cond_AX</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">samp</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="va">S</span> <span class="op">==</span> <span class="fl">1</span>,<span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">y_mod</span> <span class="op">&lt;-</span> <span class="va">Y</span> <span class="op">~</span> <span class="va">A</span> <span class="op">*</span> <span class="va">X</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">a_mod</span> <span class="op">&lt;-</span> <span class="va">A</span> <span class="op">~</span> <span class="va">X</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">s_mod</span> <span class="op">&lt;-</span> <span class="va">P_S_cond_AX</span> <span class="op">~</span> <span class="va">A</span> <span class="op">+</span> <span class="va">X</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">svycdiff</span><span class="op">(</span><span class="va">samp</span>, <span class="st">"OM"</span>, <span class="va">a_mod</span>, <span class="va">s_mod</span>, <span class="va">y_mod</span>, <span class="st">"gaussian"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Outcome Model:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> glm(formula = y_form, family = y_fam, data = df)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Treatment Model:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> glm(formula = a_form, family = "quasibinomial", data = df)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Selection Model:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> betareg(formula = s_form, data = df)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CDIFF:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   CDIFF      SE     LCL     UCL P-Value </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1.0833  0.0946  0.8980  1.2687  0.0000 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CDIFF:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   CDIFF      SE     LCL     UCL P-Value </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1.0833  0.0946  0.8980  1.2687  0.0000 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Outcome Model:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Treatment Model:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Selection Model:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> betareg(formula = s_form, data = df)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Quantile residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min      1Q  Median      3Q     Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -3.9217 -0.5517  0.0146  0.5745  4.6954 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients (mean model with logit link):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) 0.015923   0.006394    2.49   0.0128 *  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A           0.983983   0.007764  126.74   &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X           0.991856   0.004474  221.71   &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Phi coefficients (precision model with identity link):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (phi)   808.32      40.79   19.82   &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Type of estimator: ML (maximum likelihood)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Log-likelihood:  2457 on 4 Df</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Pseudo R-squared: 0.9923</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of iterations: 61 (BFGS) + 3 (Fisher scoring) </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Stephen Salerno, Emily K Roberts, Tyler H McCormick, Bhramar Mukherjee, Xu Shi.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer></div>






  </body></html>

