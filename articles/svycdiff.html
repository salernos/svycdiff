<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the svycdiff package • svycdiff</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using the svycdiff package">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">svycdiff</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/svycdiff.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/salernos/svycdiff/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using the svycdiff package</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/salernos/svycdiff/blob/master/vignettes/svycdiff.Rmd" class="external-link"><code>vignettes/svycdiff.Rmd</code></a></small>
      <div class="hidden name"><code>svycdiff.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="welcome">Welcome!<a class="anchor" aria-label="anchor" href="#welcome"></a>
</h2>
<p>In this vignette, we provide a brief introduction to using the
<code>R</code> package <code>svycdiff</code>. The purpose of this
package is to to estimate population average controlled difference
(ACD), or under stronger assumptions, the population average treatment
effect (PATE), for a given outcome between levels of a binary treatment,
exposure, or other group membership variable of interest for clustered,
stratified survey samples where sample selection depends on the
comparison group. This vignette gives an overview of the <code>R</code>
package and its implementation, but omits the technical details about
this estimation approach. For additional details about the statistical
methodology, please refer to Salerno et al. (2024+) <em>“What’s the
weight? Estimating controlled outcome differences in complex surveys for
health disparities research.”</em></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/salernos/svycdiff" class="external-link">svycdiff</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-with-simulated-data">Example With Simulated Data<a class="anchor" aria-label="anchor" href="#example-with-simulated-data"></a>
</h2>
<div class="section level3">
<h3 id="population-parameters">Population Parameters<a class="anchor" aria-label="anchor" href="#population-parameters"></a>
</h3>
<p>In this first example, we provide an illustration of the method using
simulated data. We first generate a superpopulation of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mn>10</mn><mo>,</mo><mn>000</mn></mrow><annotation encoding="application/x-tex">N = 10,000</annotation></semantics></math>
individuals from which we can repeatedly take weighted samples. The
population parameters are as follows:</p>
<ul>
<li>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
denote a continuous (normal) outcome of interest</li>
<li>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
denote the primary (binary) predictor of interest</li>
<li>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
denote a set of predictors which relate to both
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
</li>
</ul>
<p>In the context of this work, the sampling mechanism depends on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>.
For simplicity, we have reduced the set of covariates in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
to be a single, Normal random variable:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">X \sim N(1, 1)</annotation></semantics></math>.</p>
</div>
<div class="section level3">
<h3 id="data-generation">Data Generation<a class="anchor" aria-label="anchor" href="#data-generation"></a>
</h3>
<p>Population data corresponding to our independent predictor
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
were first simulated. We then generated the rest of our data from three
models: (1) the propensity model
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>A</mi><mo>∣</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(A \mid X)</annotation></semantics></math>,
which characterized our primary predictor of interest, (2) the selection
model, which defines the probability of inclusion into the sample given
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>,
and (3) the outcome model
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo>∣</mo><mi>A</mi><mo>,</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(Y \mid A, X)</annotation></semantics></math>,
which characterizes the true distribution of the outcome.</p>
<p><strong>Propensity Model</strong></p>
<p>We denote the primary (binary) predictor,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>,
as an indicator of the comparison groups of interest (e.g., treatment or
exposure groups), and we simulate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
such that:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>∣</mo><mi>X</mi><mo>∼</mo><mtext mathvariant="normal">Bin</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mo>,</mo><msub><mi>p</mi><mi>A</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">A \mid  X \sim \text{Bin}(N, p_A)</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>A</mi></msub><mo>=</mo><msup><mtext mathvariant="normal">logit</mtext><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>τ</mi><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mspace width="0.222em"></mspace><mo>+</mo><mspace width="0.222em"></mspace><mo>exp</mo><mo stretchy="false" form="prefix">{</mo><mo>−</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>τ</mi><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">p_A = \text{logit}^{-1}(\tau X) = \frac{1}{1\ +\ \exp\{-(\tau X)\}}</annotation></semantics></math></p>
<p>where we let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>τ</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\tau = 1</annotation></semantics></math>.</p>
<p><strong>Selection Model</strong></p>
<p>We denote the probability of being selected into the sample as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>S</mi></msub><annotation encoding="application/x-tex">p_S</annotation></semantics></math>
and we simulate this probability such that:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>S</mi></msub><mo>=</mo><msup><mtext mathvariant="normal">logit</mtext><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>β</mi><mn>0</mn></msub><mo>+</mo><msub><mi>β</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>A</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.222em"></mspace><mo>+</mo><mspace width="0.222em"></mspace><msub><mi>β</mi><mn>2</mn></msub><mi>X</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mspace width="0.222em"></mspace><mo>+</mo><mspace width="0.222em"></mspace><mo>exp</mo><mo stretchy="false" form="prefix">{</mo><mo>−</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>β</mi><mn>0</mn></msub><mo>+</mo><msub><mi>β</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>A</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.222em"></mspace><mo>+</mo><mspace width="0.222em"></mspace><msub><mi>β</mi><mn>2</mn></msub><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">p_S = \text{logit}^{-1}[\beta_0 +\beta_1(1 - A)\ +\ \beta_2 X] = \frac{1}{1\ +\ \exp\{-(\beta_0 +\beta_1(1 - A)\ +\ \beta_2 X)\}}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mn>0</mn></msub><mo>=</mo><mo>−</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">\beta_0 = -3</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mn>1</mn></msub><mo>=</mo><msub><mi>β</mi><mn>2</mn></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\beta_1 = \beta_2 = 1</annotation></semantics></math>.
We further denote the observation/sampling weights for the study as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ω</mi><mi>S</mi></msub><mo>=</mo><msubsup><mi>p</mi><mi>S</mi><mrow><mo>−</mo><mn>1</mn></mrow></msubsup></mrow><annotation encoding="application/x-tex">\omega_S = p_S^{-1}</annotation></semantics></math>.</p>
<p><strong>Outcome Model</strong></p>
<p>In generating the outcome, <em>we consider treatment
heterogeneity</em>. Denote the outcome model as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><msub><mi>γ</mi><mn>0</mn></msub><mo>+</mo><msub><mi>γ</mi><mn>1</mn></msub><mi>X</mi><mo>+</mo><msub><mi>γ</mi><mn>2</mn></msub><mi>A</mi><mo>+</mo><msub><mi>γ</mi><mn>3</mn></msub><mi>A</mi><mi>X</mi><mo>+</mo><mi>ε</mi><mo>;</mo><mspace width="1.0em"></mspace><mi>ε</mi><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>0.5</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y = \gamma_0 + \gamma_1 X + \gamma_2 A + \gamma_3 A X + \varepsilon;
\quad \varepsilon \sim N(0, 0.5)</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>γ</mi><mn>0</mn></msub><mo>=</mo><msub><mi>γ</mi><mn>1</mn></msub><mo>=</mo><msub><mi>γ</mi><mn>2</mn></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\gamma_0 = \gamma_1 = \gamma_2 = 1</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>γ</mi><mn>3</mn></msub><mo>=</mo><mn>0.1</mn></mrow><annotation encoding="application/x-tex">\gamma_3 = 0.1</annotation></semantics></math>.
Our quantity of interest is the average controlled difference (ACD), or
under stronger assumptions, the population average treatment effect.
Given the superpopulation generated according to the models above, we
then take a random sample by generating a sampling indicator
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mspace width="0.222em"></mspace><mo stretchy="false" form="prefix">|</mo><mspace width="0.222em"></mspace><mi>A</mi><mo>,</mo><mi>X</mi><mo>∼</mo><mtext mathvariant="normal">Bin</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mo>,</mo><mspace width="0.222em"></mspace><msub><mi>p</mi><mi>s</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">S\ |\ A, X \sim \text{Bin}(N,\ p_s)</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#-- Set Seed for Random Number Generation</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#-- Define Population Parameter Values</span></span>
<span></span>
<span><span class="co">#- Population Size</span></span>
<span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span></span>
<span><span class="co">#- Propensity Model Parameter</span></span>
<span></span>
<span><span class="va">tau</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co">#- Selection Model Parameters</span></span>
<span></span>
<span><span class="va">beta0</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">3</span></span>
<span></span>
<span><span class="va">beta1</span> <span class="op">&lt;-</span> <span class="fl">1</span> </span>
<span></span>
<span><span class="va">beta2</span> <span class="op">&lt;-</span> <span class="fl">1</span> </span>
<span></span>
<span><span class="co">#- Outcome Model Parameters</span></span>
<span></span>
<span><span class="va">gamma0</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  </span>
<span><span class="va">gamma1</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">gamma2</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">gamma3</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span></span>
<span><span class="co">#-- Simulate Data</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">tau</span> <span class="op">*</span> <span class="va">X</span><span class="op">)</span></span>
<span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="va">p_A</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">beta0</span> <span class="op">+</span> <span class="va">beta1</span> <span class="op">*</span> <span class="va">A</span> <span class="op">+</span> <span class="va">beta2</span> <span class="op">*</span> <span class="va">X</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s_wt</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">p_S</span></span>
<span></span>
<span><span class="va">aa</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">Y1</span> <span class="op">&lt;-</span> <span class="va">gamma0</span> <span class="op">+</span> <span class="va">gamma1</span> <span class="op">*</span> <span class="va">X</span> <span class="op">+</span> <span class="va">gamma2</span> <span class="op">*</span> <span class="va">aa</span> <span class="op">+</span> <span class="va">gamma3</span> <span class="op">*</span> <span class="va">X</span> <span class="op">*</span> <span class="va">aa</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span>
<span><span class="va">aa</span> <span class="op">&lt;-</span> <span class="fl">0</span>; <span class="va">Y0</span> <span class="op">&lt;-</span> <span class="va">gamma0</span> <span class="op">+</span> <span class="va">gamma1</span> <span class="op">*</span> <span class="va">X</span> <span class="op">+</span> <span class="va">gamma2</span> <span class="op">*</span> <span class="va">aa</span> <span class="op">+</span> <span class="va">gamma3</span> <span class="op">*</span> <span class="va">X</span> <span class="op">*</span> <span class="va">aa</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">A</span> <span class="op">*</span> <span class="va">Y1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">A</span><span class="op">)</span> <span class="op">*</span> <span class="va">Y0</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">Y</span>, <span class="va">A</span>, <span class="va">X</span>, <span class="va">p_A</span>, <span class="va">p_S</span>, <span class="va">s_wt</span><span class="op">)</span></span>
<span></span>
<span><span class="va">true_cdiff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Y1</span> <span class="op">-</span> <span class="va">Y0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="va">p_S</span><span class="op">)</span></span>
<span></span>
<span><span class="va">samp</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="va">S</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span></code></pre></div>
<p><strong>Note:</strong> In the package, we provide a function,
<code>simdat</code> to generate data as we have above (see
<code><a href="../reference/simdat.html">?simdat</a></code> for more information). We simulate the data in this
example manually for illustration.</p>
</div>
<div class="section level3">
<h3 id="fitting-the-model">Fitting the Model<a class="anchor" aria-label="anchor" href="#fitting-the-model"></a>
</h3>
<p>In order to fit the overall model, the user must specify the data (in
our case, <code>samp</code>), the method we will use to estimate the
controlled difference (here we will use outcome regression and direct
standardization, <code>"OM"</code>; see <code><a href="../reference/svycdiff.html">?svycdiff</a></code> for more
details), and formulas that specify the propensity, selection, and
(optionally) outcome models. From there, we can fit the method and
examine the results!</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#-- Fit Model</span></span>
<span></span>
<span><span class="va">y_mod</span> <span class="op">&lt;-</span> <span class="va">Y</span> <span class="op">~</span> <span class="va">A</span> <span class="op">*</span> <span class="va">X</span></span>
<span></span>
<span><span class="va">a_mod</span> <span class="op">&lt;-</span> <span class="va">A</span> <span class="op">~</span> <span class="va">X</span></span>
<span></span>
<span><span class="va">s_mod</span> <span class="op">&lt;-</span> <span class="va">p_S</span> <span class="op">~</span> <span class="va">A</span> <span class="op">+</span> <span class="va">X</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/svycdiff.html">svycdiff</a></span><span class="op">(</span><span class="va">samp</span>, <span class="st">"OM"</span>, <span class="va">a_mod</span>, <span class="va">s_mod</span>, <span class="va">y_mod</span>, <span class="st">"gaussian"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Outcome Model:  </span></span>
<span><span class="co">#&gt; glm(formula = y_form, family = y_fam, data = df)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Treatment Model:  </span></span>
<span><span class="co">#&gt; glm(formula = a_form, family = "quasibinomial", data = df)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Selection Model:  </span></span>
<span><span class="co">#&gt; betareg(formula = s_form, data = df)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; CDIFF:  </span></span>
<span><span class="co">#&gt;   CDIFF      SE     LCL     UCL P-Value </span></span>
<span><span class="co">#&gt;  1.1659  0.0723  1.0243  1.3076  0.0000</span></span></code></pre></div>
<p>As shown, we estimate the controlled difference to be 1.166, as
compared to the true controlled difference of 1.1096. For technical
details on the method, see please refer to Salerno et al. (2024+)
<em>“What’s the weight? Estimating controlled outcome differences in
complex surveys for health disparities research.”</em> To reproduce the
analysis results for the main paper, see
<code>inst/nhanes.Rmd</code>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Stephen Salerno, Emily K Roberts, Tyler H McCormick, Bhramar Mukherjee, Xu Shi.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
